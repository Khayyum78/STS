package com.example.inventory.infrastructure;

import com.example.inventory.domain.SaleItem;
import com.example.inventory.repository.SaleItemRepository;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public class SaleItemRepositoryImpl implements SaleItemRepository {

    private final JpaSaleItemRepository jpa;

    public SaleItemRepositoryImpl(JpaSaleItemRepository jpa) { this.jpa = jpa; }

    @Override
    public void saveAll(Long saleId, List<SaleItem> items) {
        var ents = items.stream().map(i -> JpaSaleItemEntity.builder()
                .id(i.getId())
                .saleId(saleId)
                .variantId(i.getVariantId())
                .qty(i.getQty())
                .unitPrice(i.getUnitPrice())
                .lineTotal(i.getLineTotal())
                .build()
        ).toList();
        jpa.saveAll(ents);
    }

    @Override
    public List<SaleItem> findBySaleId(Long saleId) {
        return jpa.findBySaleId(saleId).stream()
                .map(e -> new SaleItem(e.getId(), e.getSaleId(), e.getVariantId(), e.getQty(), e.getUnitPrice(), e.getLineTotal()))
                .toList();
    }
}
